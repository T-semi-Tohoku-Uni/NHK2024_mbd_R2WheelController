# NHK2024_mbd_R2WheelController
## 動作環境
- マイコン->STM32G474RET6 (nucleo)
- STM32CubeIDE 1.13.2
- 旧CAN基盤を使用
## 概要
R2の足回り制御器

モーターの速度をそれぞれPID制御で制御（タイマ割り込みによって1ms周期で計算）

モーターの回転量からロボットの実際の速度を推定し，これを用いてロボットの速度をFF+PID制御（タイマ割り込みによって1ms周期で計算）.

アームを正面として，右前から反時計回りにモーターのIDを0~3で割り振っている

## 機能
CANのデータによって速度を受け取り、それを目標値としてホイールを駆動する。ホイールの周速度を基準に運動学を計算し、ロボットの目標速度を達成するようなホイールそれぞれの目標速度を計算する。その際、BNO055を用いて得たロボットの機首方位角を用いてフィールド座標系での移動方向を計算している。
すべての制御にかかわる計算はタイマ7の割り込み内で行っている。

## CAN入力
ロボットの目標速度を入力として持つ(Vx, Vyの単位はmm/s, 角速度wはRad/s)

0.5秒以内にデータを送らないと速度目標値がリセットされるので注意

現状，目標速度はData[3]==0の時はロボット座標系、Data[3]==1の時はフィールド座標系

ID: CANID_ROBOT_VEL(0x106)

以下のゲインは適当

Vx = (Data[0] - 127) * 16

Vy = (Data[1] - 127) * 16

w  = (Data[2] - 127) * 0.02

## CAN出力
実際の速度（ロボット座標系）と機首方位角を一応1msでフィードバック
